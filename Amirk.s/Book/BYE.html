<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©ØªØ§Ø¨</title>
  <style>
    body {
      font-family: "Vazir", sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      background: #f1f3f6;
    }
    header {
      background-color: #34495e;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.8em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .container {
      max-width: 1100px;
      margin: 30px auto;
      padding: 20px;
    }
    .book-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 25px;
    }
    .book-card {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      position: relative;
      transition: transform 0.2s;
    }
    .book-card:hover {
      transform: translateY(-4px);
    }
    .discount-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #e74c3c;
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.8em;
    }
    .book-card h3 {
      margin: 0 0 10px;
    }
    .book-card p {
      margin: 4px 0;
    }
    .controls {
      display: flex;
      align-items: center;
      margin-top: 10px;
      gap: 8px;
    }
    .controls button {
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      background-color: #3498db;
      color: white;
      cursor: pointer;
      font-size: 0.9em;
    }
    .controls button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .cart {
      margin-top: 40px;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .cart h2 {
      margin-top: 0;
    }
    .cart ul {
      list-style: none;
      padding: 0;
    }
    .cart li {
      margin-bottom: 6px;
      border-bottom: 1px dashed #ddd;
      padding: 6px 0;
    }
    .cart .total {
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 10px;
      color: #2c3e50;
    }
    form {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    form h2 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #34495e;
    }
    form label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      color: #2c3e50;
    }
    form input, form textarea {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
      resize: vertical;
    }
    form button {
      background-color: #27ae60;
      color: white;
      padding: 12px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    form button:hover {
      background-color: #219150;
    }
    .message {
      margin-top: 15px;
      font-weight: bold;
      color: #27ae60;
    }
  </style>
</head>
<body>

  <header>ğŸ“š ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©ØªØ§Ø¨</header>

  <div class="container">
    <div class="book-grid" id="bookList"></div>

    <div class="cart">
      <h2>ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h2>
      <ul id="cartItems"></ul>
      <div class="total" id="cartTotal">Ù…Ø¨Ù„Øº Ú©Ù„: Û° ØªÙˆÙ…Ø§Ù†</div>
    </div>

    <form id="orderForm">
      <h2>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø±ÛŒØ¯Ø§Ø±</h2>
      <label for="name">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</label>
      <input type="text" id="name" name="name" required />

      <label for="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†:</label>
      <input type="tel" id="phone" name="phone" required pattern="\\d{10,15}" placeholder="Ù…Ø«Ù„Ø§Ù‹ 09123456789" />

      <label for="address">Ø¢Ø¯Ø±Ø³:</label>
      <textarea id="address" name="address" rows="3" required></textarea>

      <button type="submit">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª</button>
      <div class="message" id="message"></div>
    </form>
  </div>

  <script>
    const books = [
      { name: "Ù…Ù„Øª Ø¹Ø´Ù‚", price: 85000, quantity: 10, discount: 20 },
      { name: " Ù…Ù† Ù„ÛŒØ§Ù‚ØªÙ… Ø®Ø¯Ø§Ø­Ø§ÙØ¸ÛŒ Ø¨Ù‡ØªØ±ÛŒ Ø¨ÙˆØ¯", price: 65000, quantity: 6, discount: 0 },
      { name: "Ø¨Ø³ Ø§Ø² ØªÙˆ", price: 100000, quantity: 8, discount: 15 },
      { name: "Ù…Ø§Ø±Ø§Ø¯ÙˆÙ†Ø§", price: 58000, quantity: 4, discount: 0 },
      { name: "Ú©ÛŒÙ…ÛŒØ§Ú¯Ø±", price: 72000, quantity: 7, discount: 10 }
    ];

    let cart = [];

    const bookList = document.getElementById("bookList");
    const cartItems = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");
    const orderForm = document.getElementById("orderForm");
    const message = document.getElementById("message");

    function renderBooks() {
      bookList.innerHTML = "";
      books.forEach((book, index) => {
        const card = document.createElement("div");
        card.className = "book-card";

        const finalPrice = Math.round(book.price * (1 - book.discount / 100));

        card.innerHTML = `
          ${book.discount ? `<div class="discount-badge">${book.discount}% ØªØ®ÙÛŒÙ</div>` : ""}
          <h3>${book.name}</h3>
          <p>Ù‚ÛŒÙ…Øª: <del>${book.price.toLocaleString()}</del> 
             <strong>${finalPrice.toLocaleString()}</strong> ØªÙˆÙ…Ø§Ù†</p>
          <p>Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${book.quantity}</p>
          <div class="controls">
            <button onclick="addToCart(${index})" ${book.quantity === 0 ? "disabled" : ""}>+</button>
            <button onclick="removeFromCart(${index})">âˆ’</button>
          </div>
        `;
        bookList.appendChild(card);
      });
    }

    function addToCart(index) {
      if (books[index].quantity > 0) {
        books[index].quantity--;
        cart.push(index);
        renderBooks();
        renderCart();
      }
    }

    function removeFromCart(index) {
      const i = cart.lastIndexOf(index);
      if (i !== -1) {
        cart.splice(i, 1);
        books[index].quantity++;
        renderBooks();
        renderCart();
      }
    }

    function renderCart() {
      cartItems.innerHTML = "";
      const grouped = {};
      cart.forEach(i => {
        grouped[i] = (grouped[i] || 0) + 1;
      });

      let total = 0;

      for (const i in grouped) {
        const count = grouped[i];
        const book = books[i];
        const finalPrice = Math.round(book.price * (1 - book.discount / 100));
        total += finalPrice * count;

        const li = document.createElement("li");
        li.textContent = `${book.name} Ã— ${count} = ${(finalPrice * count).toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
        cartItems.appendChild(li);
      }

      cartTotal.textContent = `Ù…Ø¨Ù„Øº Ú©Ù„: ${total.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
    }

    orderForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      message.textContent = "";
      message.style.color = "#27ae60";

      if (cart.length === 0) {
        message.style.color = "red";
        message.textContent = "Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!";
        return;
      }

      const name = orderForm.name.value.trim();
      const phone = orderForm.phone.value.trim();
      const address = orderForm.address.value.trim();

      if (!name || !phone || !address) {
        message.style.color = "red";
        message.textContent = "Ù„Ø·ÙØ§ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.";
        return;
      }

      const items = {};
      cart.forEach(i => {
        items[i] = (items[i] || 0) + 1;
      });

      
      const orderItems = Object.entries(items).map(([index, qty]) => {
        const book = books[index];
        return {
          name: book.name,
          quantity: qty,
          unitPrice: Math.round(book.price * (1 - book.discount / 100))
        };
      });

      const orderData = {
        customer: { name, phone, address },
        items: orderItems
      };

      
      try {
        const response = await fetch('/submit-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });

        if (!response.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´');

        const result = await response.json();

        if (result.success) {
          message.style.color = "green";
          message.textContent = "Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯! Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª...";
         
          orderForm.reset();
          cart = [];
          renderBooks();
          renderCart();
        } else {
          message.style.color = "red";
          message.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´: " + (result.message || "Ù†Ø§Ù…Ø´Ø®Øµ");
        }

      } catch (err) {
        message.style.color = "red";
        message.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±: " + err.message;
      }
    });

    renderBooks();
    renderCart();
  </script>

</body>
</html>
